<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.restaurant">

	<resultMap type="restaurantDTO" id="restResult">
		<result property="restIdx" column="restIdx" />
		<result property="restName" column="restName" />
		<result property="restAddress" column="restAddress" />
		<result property="restJibunAddress" column="restJibunAddress" />
		<result property="restPhone" column="restPhone" />
		<result property="restMenu" column="restMenu" />
		<result property="restPrice" column="restPrice" />
		<result property="restPark" column="restPark" />
		<result property="restOpen" column="restOpen" />
		<result property="restMenuList" column="restMenuList" />
		<result property="restTag" column="restTag" />
		<result property="restUpdateDate" column="restUpdateDate" />
		<result property="restStarAvg" column="restStarAvg" />
		<result property="restVisitCount" column="restVisitCount" />
		<result property="restReviewCount" column="restReviewCount" />
		<result property="restJjim" column="restJjim" />
		<result property="hotplaceIdx" column="hotplaceIdx" />
	</resultMap>
	
	<resultMap type="imageDTO" id="imgResult">
		<result property="imageFileNO" column="imageFileNO" />
		<result property="imageFileName" column="imageFileName" />
		<result property="regDate" column="regDate" />
		<result property="articleIdx" column="articleIdx" />
		<result property="restaurantIdx" column="restaurantIdx" />
	</resultMap>

	<!-- 매장 상세보기  -->
	<select id="selectRestView" resultType="restaurantDTO"
		parameterType="int">
		<![CDATA[
			SELECT * FROM RESTAURANT_INFO WHERE RESTIDX = #{restIdx}
		]]>
	</select>
	
	<select id="selectAllViews" resultType="restaurantDTO">
		<![CDATA[
			SELECT * FROM RESTAURANT_INFO ORDER BY RESTIDX
		]]>
	</select>
	
	<select id="selectAllresImgList" resultType="imageDTO"
		parameterType="int">
		<![CDATA[
			SELECT * FROM IMAGE_INFO WHERE RESTAURANTIDX = #{restIdx}
		]]>
	</select>
	
	<!-- 찜 TOP 50 조회 -->
	<select id="selectSteamList" resultType="restaurantDTO">
		<![CDATA[
			SELECT * FROM RESTAURANT_INFO WHERE rownum <= 50 ORDER BY RESTSTARAVG desc	
		]]>
	</select>
	
	<!-- 방문 TOP 50 조회 -->
	<select id="selectVisitList" resultType="restaurantDTO">
		<![CDATA[
			SELECT * FROM RESTAURANT_INFO WHERE rownum <= 50 ORDER BY restVisitCount desc
		]]>
	</select>
	
	<!-- 별점 TOP 50 조회 -->
	<select id="selectStarList" resultType="restaurantDTO">
		<![CDATA[
			SELECT * FROM RESTAURANT_INFO WHERE rownum <= 50 ORDER BY restStarAvg desc
		]]>
	</select>
	
	<!-- 거리 TOP 50 조회 -->
	<select id="selectDistanceList" resultType="restaurantDTO">
		<![CDATA[
			SELECT * FROM RESTAURANT_INFO WHERE RESTADDRESS  like '%서울%' AND rownum<=50
		]]>
	</select>
	
	<!-- 인기 TOP 50 조회 -->
	<select id="selectFamousList" resultType="restaurantDTO">
		<![CDATA[
			SELECT * FROM (SELECT * FROM RESTAURANT_INFO ORDER BY restVisitCount desc) WHERE rownum <= 50 ORDER BY RESTSTARAVG asc
		]]>
	</select>
	<!-- 메인 이미지 조회 -->
	<select id="selectImgList" resultType="imageDTO">
		<![CDATA[
			SELECT * FROM IMAGE_INFO WHERE RESTAURANTIDX = #{restaurantIdx} AND ROWnum<=1 ORDER BY regdate desc
		]]>
	</select>
	
	<!-- 매장 상세보기 조회수 증가 -->
	<update id="updatePlusVisitCount" parameterType="int">
		<![CDATA[ 
			UPDATE RESTAURANT_INFO SET RESTVISITCOUNT = RESTVISITCOUNT +1 WHERE RESTIDX = #{restIdx}
		]]>
	</update>
	
	<!-- 매장 찜 - 1 -->
	<update id="deleteResJjim" parameterType="int">
		<![CDATA[ 
			UPDATE RESTAURANT_INFO SET restJjim = restJjim -1 WHERE RESTIDX = #{restIdx}
		]]>
	</update>
	
	<!-- 매장 찜 + 1 -->
	<update id="addResJjim" parameterType="int">
		<![CDATA[ 
			UPDATE RESTAURANT_INFO SET restJjim = restJjim +1 WHERE RESTIDX = #{restIdx}
		]]>
	</update>
	
	<!-- 매장 별점 평균 업데이트 -->
	<update id="updateStarAvg" parameterType="java.util.Map">
		<![CDATA[ 
			UPDATE RESTAURANT_INFO SET restStarAvg = #{Avg} WHERE RESTIDX = #{restaurantIdx}
		]]>
	</update>

</mapper>